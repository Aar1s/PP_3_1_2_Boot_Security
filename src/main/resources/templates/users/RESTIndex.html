<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">

    <title>KATA-Users</title>
</head>
<body class="bg-light">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
<script type="text/javascript">
    const defaultUser = {
        "id": 1,
        "name": "Default",
        "surname": "User",
        "age": 41,
        "roles": [
            {
                "id": 1,
                "name": "ROLE_USER",
                "users": null,
                "authority": "ROLE_USER"
            },
            {
                "id": 2,
                "name": "ROLE_ADMIN",
                "users": null,
                "authority": "ROLE_ADMIN"
            }
        ],
        "username": "DefaultUser@gmail.com",
        "password": "123",
        "enabled": true,
        "credentialsNonExpired": true,
        "accountNonExpired": true,
        "accountNonLocked": true
    }

    function createHeader(activeUser=defaultUser) {
        let header = document.createElement("header");
        let roles = "";
        if (activeUser.roles.length > 1) {
            roles = "ADMIN, USER";
        } else {
            roles = "USER";
        }
        header.innerHTML = `
            <div>
                <div class="header">
                    <div class="container-fluid">
                        <div class="row bg-dark">
                            <div class="col-11">
                                <div class="text-white mt-3">
                                    <strong id="activeUser">${activeUser.username}</strong>
                                     with roles: ${roles}
                                </div>
                            </div>
                            <div class="col-1">
                                <div class="btn">
                                    <a class="btn btn-outline-light btn-lg" href="/logout/" role="button">Logout</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`
        document.body.appendChild(header);
    }


    function createSidebar(activeUser=defaultUser) {
        let sidebar = document.createElement("div");
        let navbar = document.createElement("div");
        sidebar.innerHTML = `<div class="row" id="mainRow">
            <div id="rolesNavbar" class="col-2 sidebar container-fluid bg-white text-center" style="height:100vh"></div>
            <!-- Main Panel -->
            <div id="MainPanel" class="col-10">
                <h2 id="destructible"> This has to be destroyed</h2>
                <button id="buttonToCreateAndDestroy" class="btn btn-danger">Button to destroy</button>
            </div>
        </div>`
        document.body.appendChild(sidebar)
        if (activeUser.roles.length > 1) {
            navbar.innerHTML = `
                <a class="nav-link active" href="#adminPanel" role="tab"
                           aria-controls="v-pills-home" aria-selected="true">Admin</a>
                <a class="nav-link" href="#userPanel"  role="tab"
                           aria-controls="v-pills-profile" aria-selected="false">User</a>
                `
        } else {
            navbar.innerHTML = `
            <a class="nav-link active" href="#userPanel"  role="tab"
                           aria-controls="v-pills-profile" aria-selected="true">User</a>

            `
        }

        navbar.setAttribute("class", "nav flex-column nav-pills pt-4");
        navbar.setAttribute("role", "tablist");
        navbar.setAttribute("aria-orientation", "vertical");

        let sidebarToCreate = document.querySelector("#rolesNavbar");
        sidebarToCreate.appendChild(navbar);
    }


    function createMainPanel(activeUser=defaultUser) {
        let mainPanel = document.createElement("div");
        mainPanel.setAttribute("class", "col-10")

        mainPanel.innerHTML = `

        `
        document.querySelector("#mainRow").appendChild(mainPanel);
    }


    document.addEventListener("DOMContentLoaded", function () {
        const URL = "http://localhost:8080/test/api/";

        let promise = fetch(URL).then(response => response.json()).then(data => {
            const  resp = data;
        })
        createHeader();
        createSidebar();


    })


    document.querySelector('#buttonToCreateAndDestroy').onclick = function () {
        if (document.querySelector("#destructible")) {
            document.querySelector("#destructible").remove();
            document.querySelector("#buttonToCreateAndDestroy").textContent = "Button to create";
        } else {
            document.querySelector("#buttonToCreateAndDestroy").textContent = "Button to destroy";
            let divToChange = document.querySelector("#MainPanel")
            let newElem = document.createElement("h2");
            newElem.setAttribute("id","destructible");
            const text = document.createTextNode( "This Was Created Anew!");
            newElem.appendChild(text);
            divToChange.appendChild(newElem);
        }
    }
</script>
</body>
</html>